<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Predict Classes for New Samples • cola</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Predict Classes for New Samples">
<meta property="og:description" content="cola">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cola</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Standard consensus partitioning</li>
    <li>
      <a href="../articles/cola_quick.html">A Quick Start of Using cola Package</a>
    </li>
    <li>
      <a href="../articles/cola_general.html">A Framework for Consensus Partitioning</a>
    </li>
    <li>
      <a href="../articles/functional_enrichment.html">Automatic Functional Enrichment on Signature genes</a>
    </li>
    <li>
      <a href="../articles/predict.html">Predict Classes for New Samples</a>
    </li>
    <li>
      <a href="../articles/work_with_big_datasets.html">Work with Big Datasets</a>
    </li>
    <li>
      <a href="../articles/compare_partitions.html">Compare Partitions</a>
    </li>
    <li>
      <a href="../articles/ATC_methods.html">ATC - More Forms</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Hierarchical partitioning</li>
    <li>
      <a href="../articles/hierarchical.html">Hierarchical consensus partitioning</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Other examples</li>
    <li>
      <a href="../articles/AML.html">Re-analyze an AML proteomics dataset</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">On public datasets</li>
    <li>
      <a href="../articles/examples.html">Applications on public datasets</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Supplementary files</li>
    <li>
      <a href="https://jokergoo.github.io/cola_supplementary/" class="external-link">Supplementary files for cola NAR paper</a>
    </li>
    <li>
      <a href="https://cola-rh.github.io/supplementary/" class="external-link">Supplementary files for cola BIB paper</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/cola/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Predict Classes for New Samples</h1>
                        <h4 data-toc-skip class="author">Zuguang Gu (<a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a>)</h4>
            
            <h4 data-toc-skip class="date">2024-02-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/cola/blob/HEAD/vignettes/predict.Rmd" class="external-link"><code>vignettes/predict.Rmd</code></a></small>
      <div class="hidden name"><code>predict.Rmd</code></div>

    </div>

    
    
<p><code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code> function predicts sample classes based on cola classification. It is mainly used in the following two scenarios:</p>
<ol style="list-style-type: decimal">
<li>Predict sample classes in a new study.</li>
<li>For a dataset with huge number of samples, users can apply <em>cola</em> on a randomly sampled subset of samples and predict classes for the remaining samples.</li>
</ol>
<p>To use a <em>cola</em> classification, users need to select the result from a specific top-value method and partitioning method, i.e., the input should be a <code>ConsensusPartition</code> object. In the following example, we use the analysis from <a href="https://jokergoo.github.io/cola_examples/Golub_leukemia/" class="external-link">Golub dataset</a> and we take the result from the method <code>ATC:skmeans</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">golub_cola</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="va">golub_cola</span><span class="op">[</span><span class="st">"ATC:skmeans"</span><span class="op">]</span></span>
<span><span class="va">res</span></span></code></pre></div>
<pre><code><span><span class="co">## A 'ConsensusPartition' object with k = 2, 3, 4, 5, 6.</span></span>
<span><span class="co">##   On a matrix with 4116 rows and 72 columns.</span></span>
<span><span class="co">##   Top rows (412) are extracted by 'ATC' method.</span></span>
<span><span class="co">##   Subgroups are detected by 'skmeans' method.</span></span>
<span><span class="co">##   Performed in total 250 partitions by row resampling.</span></span>
<span><span class="co">##   Best k for subgroups seems to be 3.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Following methods can be applied to this 'ConsensusPartition' object:</span></span>
<span><span class="co">##  [1] "cola_report"             "collect_classes"         "collect_plots"          </span></span>
<span><span class="co">##  [4] "collect_stats"           "colnames"                "compare_partitions"     </span></span>
<span><span class="co">##  [7] "compare_signatures"      "consensus_heatmap"       "dimension_reduction"    </span></span>
<span><span class="co">## [10] "functional_enrichment"   "get_anno"                "get_anno_col"           </span></span>
<span><span class="co">## [13] "get_classes"             "get_consensus"           "get_matrix"             </span></span>
<span><span class="co">## [16] "get_membership"          "get_param"               "get_signatures"         </span></span>
<span><span class="co">## [19] "get_stats"               "is_best_k"               "is_stable_k"            </span></span>
<span><span class="co">## [22] "membership_heatmap"      "ncol"                    "nrow"                   </span></span>
<span><span class="co">## [25] "plot_ecdf"               "predict_classes"         "rownames"               </span></span>
<span><span class="co">## [28] "select_partition_number" "show"                    "suggest_best_k"         </span></span>
<span><span class="co">## [31] "test_to_known_factors"   "top_rows_heatmap"</span></span></code></pre>
<p><code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code> needs at least three arguments: a <code>ConsensusPartition</code> object, the number of subgroups and the new matrix. The first two are for extracting the classification as well as the signatures that best separate subgroups. The new matrix should have the same number of rows as the matrix used for <em>cola</em> analysis, also the row orders should be the same. <strong>Be careful that the scaling of the new matrix should also be the same as the one applied in cola analysis.</strong></p>
<p>The prediction is based on <strong>the signature centroid matrix</strong>. The processes are as follows:</p>
<ol style="list-style-type: decimal">
<li>For the provided <code>ConsensusPartition</code> object and a selected k, the signatures that discriminate classes are extracted by <code><a href="../reference/get_signatures-dispatch.html">get_signatures()</a></code>. If number of signatures is more than 500, only 500 most significant signatures are used.</li>
<li>The signature centroid matrix is a k-column matrix where each column is the centroid of samples in the corresponding class, i.e., the mean across samples. If rows were scaled in <em>cola</em> analysis, the signature centroid matrix is the mean of scaled values and vise versa. Please note the samples with silhouette score less than <code>silhouette_cutoff</code> (0.5 as the default) are removed for calculating the centroids.</li>
<li>With the signature centroid matrix and the new matrix, it perform the prediction.</li>
</ol>
<p>The class prediction is applied as follows. For each sample in the new matrix, the task is basically to test which signature centroid the current sample is the closest to. There are three methods: the Euclidean distance, cosine distance (it is <code>1-cos(x, y)</code>) and the correlation (Spearman) distance.</p>
<p>For the Euclidean distance and cosine distance method, for the vector denoted as <span class="math inline">\(x\)</span> which corresponds to sample <span class="math inline">\(i\)</span> in the new matrix, to test which class should be assigned to sample <span class="math inline">\(i\)</span>, the distance between sample <span class="math inline">\(i\)</span> and all <span class="math inline">\(k\)</span> signature centroids are calculated and denoted as <span class="math inline">\(d_1\)</span>, <span class="math inline">\(d_2\)</span>, …, <span class="math inline">\(d_k\)</span>. The class with the smallest distance is assigned to sample <span class="math inline">\(i\)</span>.</p>
<p>To test whether the class assignment is statistically significant, or to test whether the class that is assigned is significantly closest to sample <span class="math inline">\(i\)</span>, we design a statistic named “<em>difference ratio</em>”, denoted as <span class="math inline">\(r\)</span> and calculated as follows. First, The distances for <span class="math inline">\(k\)</span> centroids are sorted increasingly, and we calculate <span class="math inline">\(r\)</span> as:</p>
<p><span class="math display">\[r = \frac{|d_{(1)} - d_{(2)}|}{\bar{d}}\]</span></p>
<p>which is the difference between the smallest distance and the second smallest distance, normalized by the mean distance. To test the statistical significance of <span class="math inline">\(r\)</span>, we randomly permute rows of the signature centroid matrix and calculate <span class="math inline">\(r_{rand}\)</span>. The random permutation is performed 1000 times and the p-value is calculated as the proportion of <span class="math inline">\(r_{rand}\)</span> being larger than <span class="math inline">\(r\)</span>.</p>
<p>For the correlation method, the distance is calculated as the Spearman correlation between sample <span class="math inline">\(i\)</span> and signature centroid <span class="math inline">\(k\)</span>. The label for the class with the maximal correlation value is assigned to sample <span class="math inline">\(i\)</span>. The p-value is simply calculated by <code><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">stats::cor.test()</a></code> between sample <span class="math inline">\(i\)</span> and centroid <span class="math inline">\(k\)</span>.</p>
<p>If a sample is tested with a p-value higher than 0.05, the corresponding class label is set to <code>NA</code>.</p>
<p>To demonstrate the use of <code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code>, we use the same matrix as for <em>cola</em> analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_matrix-dispatch.html">get_matrix</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p>Note the matrix was row-scaled in <em>cola</em> analysis, thus, <code>mat</code> should also be scaled with the same method (z-score scaling).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And we predict the class of <code>mat2</code> with the 3-group classification from <code>res</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_classes-dispatch.html">predict_classes</a></span><span class="op">(</span><span class="va">res</span>, k <span class="op">=</span> <span class="fl">3</span>, <span class="va">mat2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The matrix has been scaled in cola analysis, thus the new matrix should also be scaled</span></span>
<span><span class="co">## with the same method ('z-score'). Please double check.</span></span>
<span><span class="co">## Set `help = FALSE` to suppress this message. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## * take top 500/2058 most significant signatures for prediction.</span></span></code></pre>
<p><img src="predict_files/figure-html/unnamed-chunk-5-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span></span></code></pre></div>
<pre><code><span><span class="co">##           class p</span></span>
<span><span class="co">## sample_39     3 0</span></span>
<span><span class="co">## sample_40     3 0</span></span>
<span><span class="co">## sample_42     1 0</span></span>
<span><span class="co">## sample_47     1 0</span></span>
<span><span class="co">## sample_48     1 0</span></span>
<span><span class="co">## sample_49     3 0</span></span>
<span><span class="co">## sample_41     1 0</span></span>
<span><span class="co">## sample_43     1 0</span></span>
<span><span class="co">## sample_44     1 0</span></span>
<span><span class="co">## sample_45     1 0</span></span>
<span><span class="co">## sample_46     1 0</span></span>
<span><span class="co">## sample_70     1 0</span></span>
<span><span class="co">## sample_71     1 0</span></span>
<span><span class="co">## sample_72     1 0</span></span>
<span><span class="co">## sample_68     1 0</span></span>
<span><span class="co">## sample_69     1 0</span></span>
<span><span class="co">## sample_67     1 0</span></span>
<span><span class="co">## sample_55     3 0</span></span>
<span><span class="co">## sample_56     3 0</span></span>
<span><span class="co">## sample_59     1 0</span></span>
<span><span class="co">## sample_52     2 0</span></span>
<span><span class="co">## sample_53     2 0</span></span>
<span><span class="co">## sample_51     2 0</span></span>
<span><span class="co">## sample_50     2 0</span></span>
<span><span class="co">## sample_54     1 0</span></span>
<span><span class="co">## sample_57     2 0</span></span>
<span><span class="co">## sample_58     2 0</span></span>
<span><span class="co">## sample_60     1 0</span></span>
<span><span class="co">## sample_61     2 0</span></span>
<span><span class="co">## sample_65     2 0</span></span>
<span><span class="co">## sample_66     1 0</span></span>
<span><span class="co">## sample_63     2 0</span></span>
<span><span class="co">## sample_64     2 0</span></span>
<span><span class="co">## sample_62     2 0</span></span>
<span><span class="co">## sample_1      3 0</span></span>
<span><span class="co">## sample_2      1 0</span></span>
<span><span class="co">## sample_3      3 0</span></span>
<span><span class="co">## sample_4      3 0</span></span>
<span><span class="co">## sample_5      1 0</span></span>
<span><span class="co">## sample_6      3 0</span></span>
<span><span class="co">## sample_7      3 0</span></span>
<span><span class="co">## sample_8      3 0</span></span>
<span><span class="co">## sample_9      1 0</span></span>
<span><span class="co">## sample_10     1 0</span></span>
<span><span class="co">## sample_11     1 0</span></span>
<span><span class="co">## sample_12     2 0</span></span>
<span><span class="co">## sample_13     1 0</span></span>
<span><span class="co">## sample_14     1 0</span></span>
<span><span class="co">## sample_15     1 0</span></span>
<span><span class="co">## sample_16     1 0</span></span>
<span><span class="co">## sample_17     1 0</span></span>
<span><span class="co">## sample_18     3 0</span></span>
<span><span class="co">## sample_19     1 0</span></span>
<span><span class="co">## sample_20     1 0</span></span>
<span><span class="co">## sample_21     1 0</span></span>
<span><span class="co">## sample_22     2 0</span></span>
<span><span class="co">## sample_23     3 0</span></span>
<span><span class="co">## sample_24     1 0</span></span>
<span><span class="co">## sample_25     2 0</span></span>
<span><span class="co">## sample_26     1 0</span></span>
<span><span class="co">## sample_27     3 0</span></span>
<span><span class="co">## sample_34     2 0</span></span>
<span><span class="co">## sample_35     2 0</span></span>
<span><span class="co">## sample_36     2 0</span></span>
<span><span class="co">## sample_37     2 0</span></span>
<span><span class="co">## sample_38     2 0</span></span>
<span><span class="co">## sample_28     2 0</span></span>
<span><span class="co">## sample_29     1 0</span></span>
<span><span class="co">## sample_30     2 0</span></span>
<span><span class="co">## sample_31     2 0</span></span>
<span><span class="co">## sample_32     2 0</span></span>
<span><span class="co">## sample_33     2 0</span></span></code></pre>
<p>We compare to the original classification:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cola_class <span class="op">=</span> <span class="fu"><a href="../reference/get_classes-dispatch.html">get_classes</a></span><span class="op">(</span><span class="va">res</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">[</span>, <span class="st">"class"</span><span class="op">]</span>,</span>
<span>           predicted <span class="op">=</span> <span class="va">cl</span><span class="op">[</span>, <span class="st">"class"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    cola_class predicted</span></span>
<span><span class="co">## 1           3         3</span></span>
<span><span class="co">## 2           3         3</span></span>
<span><span class="co">## 3           1         1</span></span>
<span><span class="co">## 4           1         1</span></span>
<span><span class="co">## 5           1         1</span></span>
<span><span class="co">## 6           3         3</span></span>
<span><span class="co">## 7           1         1</span></span>
<span><span class="co">## 8           1         1</span></span>
<span><span class="co">## 9           1         1</span></span>
<span><span class="co">## 10          1         1</span></span>
<span><span class="co">## 11          1         1</span></span>
<span><span class="co">## 12          1         1</span></span>
<span><span class="co">## 13          1         1</span></span>
<span><span class="co">## 14          1         1</span></span>
<span><span class="co">## 15          1         1</span></span>
<span><span class="co">## 16          1         1</span></span>
<span><span class="co">## 17          1         1</span></span>
<span><span class="co">## 18          3         3</span></span>
<span><span class="co">## 19          3         3</span></span>
<span><span class="co">## 20          1         1</span></span>
<span><span class="co">## 21          2         2</span></span>
<span><span class="co">## 22          2         2</span></span>
<span><span class="co">## 23          2         2</span></span>
<span><span class="co">## 24          2         2</span></span>
<span><span class="co">## 25          1         1</span></span>
<span><span class="co">## 26          2         2</span></span>
<span><span class="co">## 27          2         2</span></span>
<span><span class="co">## 28          1         1</span></span>
<span><span class="co">## 29          2         2</span></span>
<span><span class="co">## 30          2         2</span></span>
<span><span class="co">## 31          1         1</span></span>
<span><span class="co">## 32          2         2</span></span>
<span><span class="co">## 33          2         2</span></span>
<span><span class="co">## 34          2         2</span></span>
<span><span class="co">## 35          3         3</span></span>
<span><span class="co">## 36          1         1</span></span>
<span><span class="co">## 37          3         3</span></span>
<span><span class="co">## 38          3         3</span></span>
<span><span class="co">## 39          1         1</span></span>
<span><span class="co">## 40          3         3</span></span>
<span><span class="co">## 41          3         3</span></span>
<span><span class="co">## 42          3         3</span></span>
<span><span class="co">## 43          1         1</span></span>
<span><span class="co">## 44          1         1</span></span>
<span><span class="co">## 45          1         1</span></span>
<span><span class="co">## 46          2         2</span></span>
<span><span class="co">## 47          1         1</span></span>
<span><span class="co">## 48          1         1</span></span>
<span><span class="co">## 49          1         1</span></span>
<span><span class="co">## 50          1         1</span></span>
<span><span class="co">## 51          1         1</span></span>
<span><span class="co">## 52          3         3</span></span>
<span><span class="co">## 53          1         1</span></span>
<span><span class="co">## 54          1         1</span></span>
<span><span class="co">## 55          1         1</span></span>
<span><span class="co">## 56          2         2</span></span>
<span><span class="co">## 57          3         3</span></span>
<span><span class="co">## 58          1         1</span></span>
<span><span class="co">## 59          2         2</span></span>
<span><span class="co">## 60          1         1</span></span>
<span><span class="co">## 61          3         3</span></span>
<span><span class="co">## 62          2         2</span></span>
<span><span class="co">## 63          2         2</span></span>
<span><span class="co">## 64          2         2</span></span>
<span><span class="co">## 65          2         2</span></span>
<span><span class="co">## 66          2         2</span></span>
<span><span class="co">## 67          2         2</span></span>
<span><span class="co">## 68          1         1</span></span>
<span><span class="co">## 69          2         2</span></span>
<span><span class="co">## 70          2         2</span></span>
<span><span class="co">## 71          2         2</span></span>
<span><span class="co">## 72          2         2</span></span></code></pre>
<p><code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code> generates a plot which shows the process of the prediction. The left heatmap corresponds to the new matrix and the right small heatmap corresponds to the signature centroid matrix. The purple annotation on top of the first heatmap illustrates the distance of each sample to the k signatures.</p>
<p>And if we change to correlation method:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_classes-dispatch.html">predict_classes</a></span><span class="op">(</span><span class="va">res</span>, k <span class="op">=</span> <span class="fl">3</span>, <span class="va">mat2</span>, dist_method <span class="op">=</span> <span class="st">"correlation"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The matrix has been scaled in cola analysis, thus the new matrix should also be scaled</span></span>
<span><span class="co">## with the same method ('z-score'). Please double check.</span></span>
<span><span class="co">## Set `help = FALSE` to suppress this message. </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## * take top 500/2058 most significant signatures for prediction.</span></span></code></pre>
<p><img src="predict_files/figure-html/unnamed-chunk-7-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span></span></code></pre></div>
<pre><code><span><span class="co">##           class             p</span></span>
<span><span class="co">## sample_39     3  1.665687e-61</span></span>
<span><span class="co">## sample_40     3  8.876972e-49</span></span>
<span><span class="co">## sample_42     1  5.335467e-29</span></span>
<span><span class="co">## sample_47     1  3.131227e-55</span></span>
<span><span class="co">## sample_48     1 1.618997e-130</span></span>
<span><span class="co">## sample_49     3 1.665001e-113</span></span>
<span><span class="co">## sample_41     1 1.300113e-150</span></span>
<span><span class="co">## sample_43     1  6.031124e-31</span></span>
<span><span class="co">## sample_44     1  3.653788e-75</span></span>
<span><span class="co">## sample_45     1  4.659084e-50</span></span>
<span><span class="co">## sample_46     1  3.901631e-50</span></span>
<span><span class="co">## sample_70     1  2.903322e-13</span></span>
<span><span class="co">## sample_71     1  2.205389e-07</span></span>
<span><span class="co">## sample_72     1  5.211682e-21</span></span>
<span><span class="co">## sample_68     1 8.125708e-150</span></span>
<span><span class="co">## sample_69     1 5.089091e-138</span></span>
<span><span class="co">## sample_67     1  4.029656e-19</span></span>
<span><span class="co">## sample_55     3  1.434628e-27</span></span>
<span><span class="co">## sample_56     3  8.579451e-71</span></span>
<span><span class="co">## sample_59     1  2.893656e-09</span></span>
<span><span class="co">## sample_52     2  9.041974e-32</span></span>
<span><span class="co">## sample_53     2  6.479644e-83</span></span>
<span><span class="co">## sample_51     2 4.055137e-106</span></span>
<span><span class="co">## sample_50     2 9.770796e-114</span></span>
<span><span class="co">## sample_54     1  8.832310e-10</span></span>
<span><span class="co">## sample_57     2  2.098963e-39</span></span>
<span><span class="co">## sample_58     2  1.176659e-81</span></span>
<span><span class="co">## sample_60     1  2.796608e-02</span></span>
<span><span class="co">## sample_61     2  5.320162e-50</span></span>
<span><span class="co">## sample_65     2  2.751101e-62</span></span>
<span><span class="co">## sample_66     1  2.390394e-66</span></span>
<span><span class="co">## sample_63     2  2.940438e-63</span></span>
<span><span class="co">## sample_64     2  5.449233e-73</span></span>
<span><span class="co">## sample_62     2  3.518201e-40</span></span>
<span><span class="co">## sample_1      3  6.854166e-47</span></span>
<span><span class="co">## sample_2      1  3.386703e-26</span></span>
<span><span class="co">## sample_3      3  1.843526e-47</span></span>
<span><span class="co">## sample_4      3  1.242419e-42</span></span>
<span><span class="co">## sample_5      1 6.397591e-143</span></span>
<span><span class="co">## sample_6      3  1.096311e-46</span></span>
<span><span class="co">## sample_7      3  4.946118e-88</span></span>
<span><span class="co">## sample_8      3  2.912119e-78</span></span>
<span><span class="co">## sample_9      1  5.648312e-37</span></span>
<span><span class="co">## sample_10     1  8.294430e-06</span></span>
<span><span class="co">## sample_11     1  1.101739e-34</span></span>
<span><span class="co">## sample_12     2  1.754958e-27</span></span>
<span><span class="co">## sample_13     1 1.848347e-147</span></span>
<span><span class="co">## sample_14     1  7.580138e-39</span></span>
<span><span class="co">## sample_15     1 2.777622e-170</span></span>
<span><span class="co">## sample_16     1  4.964595e-37</span></span>
<span><span class="co">## sample_17     1  4.009023e-15</span></span>
<span><span class="co">## sample_18     3  2.855786e-12</span></span>
<span><span class="co">## sample_19     1  4.366128e-46</span></span>
<span><span class="co">## sample_20     1 3.014694e-141</span></span>
<span><span class="co">## sample_21     1  8.139890e-86</span></span>
<span><span class="co">## sample_22     2  3.539365e-21</span></span>
<span><span class="co">## sample_23     3  7.710796e-53</span></span>
<span><span class="co">## sample_24     1  8.391960e-60</span></span>
<span><span class="co">## sample_25     2  1.406378e-05</span></span>
<span><span class="co">## sample_26     1  1.539248e-10</span></span>
<span><span class="co">## sample_27     3 1.422010e-133</span></span>
<span><span class="co">## sample_34     2  2.790574e-95</span></span>
<span><span class="co">## sample_35     2  3.014879e-69</span></span>
<span><span class="co">## sample_36     2  1.167553e-97</span></span>
<span><span class="co">## sample_37     2  5.685684e-86</span></span>
<span><span class="co">## sample_38     2  6.403037e-55</span></span>
<span><span class="co">## sample_28     2  1.321867e-54</span></span>
<span><span class="co">## sample_29     1  4.481475e-16</span></span>
<span><span class="co">## sample_30     2  2.099773e-54</span></span>
<span><span class="co">## sample_31     2  3.643950e-70</span></span>
<span><span class="co">## sample_32     2  6.280885e-63</span></span>
<span><span class="co">## sample_33     2 8.815045e-134</span></span></code></pre>
<p>As we can see from the above two heatmaps, correlation method is less strict than the Euclidean method that the two samples that cannot be assigned to any class with Euclidean method are assigned with certain classes under correlation method.</p>
<p><code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code> can also be directly applied to a signature centroid matrix. Following is how we manually generate the signature centroid matrix for 3-group classification from Golub dataset:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_signatures-dispatch.html">get_signatures</a></span><span class="op">(</span><span class="va">res</span>, k <span class="op">=</span> <span class="fl">3</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## * 72/72 samples (in 3 classes) remain after filtering by silhouette (&gt;= 0.5).</span></span>
<span><span class="co">## * cache hash: 87c63a8cabc898f97a024514962787f7 (seed 888).</span></span>
<span><span class="co">## * calculating row difference between subgroups by Ftest.</span></span>
<span><span class="co">##   - row difference is extracted from cache.</span></span>
<span><span class="co">## * use k-means partition that are already calculated in previous runs.</span></span>
<span><span class="co">## * 2058 signatures (50.0%) under fdr &lt; 0.05, group_diff &gt; 0.</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the centroids are already in `tb`, both scaled and unscaled, we just simply extract it</span></span>
<span><span class="va">sig_mat</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"scaled_mean"</span>, <span class="fu"><a href="../reference/colnames-dispatch.html">colnames</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sig_mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">sig_mat</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/colnames-dispatch.html">colnames</a></span><span class="op">(</span><span class="va">sig_mat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"class"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="../reference/ncol-dispatch.html">ncol</a></span><span class="op">(</span><span class="va">sig_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sig_mat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          class1      class2     class3</span></span>
<span><span class="co">## [1,] -0.4997955  0.53497043  0.2966968</span></span>
<span><span class="co">## [2,] -0.3093980  0.02013769  0.7168734</span></span>
<span><span class="co">## [3,] -0.3509730  0.58915719 -0.1576207</span></span>
<span><span class="co">## [4,] -0.1531394  0.49786781 -0.4815776</span></span>
<span><span class="co">## [5,] -0.2321462 -0.08925855  0.7167982</span></span>
<span><span class="co">## [6,] -0.2998939  0.02113042  0.6920903</span></span></code></pre>
<p>And <code>sig_mat</code> can be used in <code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_classes-dispatch.html">predict_classes</a></span><span class="op">(</span><span class="va">sig_mat</span>, <span class="va">mat2</span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_classes-dispatch.html">predict_classes</a></span><span class="op">(</span><span class="va">sig_mat</span>, <span class="va">mat2</span>, dist_method <span class="op">=</span> <span class="st">"correlation"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-apple-darwin20 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Ventura 13.2.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random number generation:</span></span>
<span><span class="co">##  RNG:     L'Ecuyer-CMRG </span></span>
<span><span class="co">##  Normal:  Inversion </span></span>
<span><span class="co">##  Sample:  Rejection </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] C/UTF-8/C/C/C/C</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Europe/Berlin</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] cola_2.9.1    knitr_1.44    markdown_1.10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] blob_1.2.4              bitops_1.0-7            Biostrings_2.68.1       RCurl_1.98-1.12        </span></span>
<span><span class="co">##  [5] fastmap_1.1.1           XML_3.99-0.14           digest_0.6.33           lifecycle_1.0.4        </span></span>
<span><span class="co">##  [9] cluster_2.1.4           Cairo_1.6-2             survival_3.5-8          KEGGREST_1.40.1        </span></span>
<span><span class="co">## [13] RSQLite_2.3.1           magrittr_2.0.3          genefilter_1.82.1       compiler_4.3.1         </span></span>
<span><span class="co">## [17] rlang_1.1.2             sass_0.4.8              rngtools_1.5.2          tools_4.3.1            </span></span>
<span><span class="co">## [21] yaml_2.3.7              brew_1.0-8              doRNG_1.8.6             bit_4.0.5              </span></span>
<span><span class="co">## [25] mclust_6.0.0            xml2_1.3.6              eulerr_7.0.0            RColorBrewer_1.1-3     </span></span>
<span><span class="co">## [29] purrr_1.0.2             BiocGenerics_0.48.1     desc_1.4.2              grid_4.3.1             </span></span>
<span><span class="co">## [33] stats4_4.3.1            xtable_1.8-4            colorspace_2.1-0        iterators_1.0.14       </span></span>
<span><span class="co">## [37] cli_3.6.2               rmarkdown_2.25          crayon_1.5.2            ragg_1.2.6             </span></span>
<span><span class="co">## [41] httr_1.4.7              rjson_0.2.21            DBI_1.1.3               cachem_1.0.8           </span></span>
<span><span class="co">## [45] stringr_1.5.0           splines_4.3.1           zlibbioc_1.46.0         parallel_4.3.1         </span></span>
<span><span class="co">## [49] AnnotationDbi_1.62.2    impute_1.74.1           XVector_0.40.0          matrixStats_1.2.0      </span></span>
<span><span class="co">## [53] vctrs_0.6.4             Matrix_1.6-1.1          jsonlite_1.8.8          slam_0.1-50            </span></span>
<span><span class="co">## [57] IRanges_2.36.0          GetoptLong_1.0.5        S4Vectors_0.40.2        bit64_4.0.5            </span></span>
<span><span class="co">## [61] irlba_2.3.5.1           clue_0.3-65             magick_2.8.0            systemfonts_1.0.5      </span></span>
<span><span class="co">## [65] foreach_1.5.2           jquerylib_0.1.4         annotate_1.78.0         glue_1.6.2             </span></span>
<span><span class="co">## [69] pkgdown_2.0.7           codetools_0.2-19        stringi_1.7.12          shape_1.4.6            </span></span>
<span><span class="co">## [73] GenomeInfoDb_1.36.4     ComplexHeatmap_2.18.0   htmltools_0.5.7         GenomeInfoDbData_1.2.10</span></span>
<span><span class="co">## [77] circlize_0.4.15         R6_2.5.1                microbenchmark_1.4.10   textshaping_0.3.7      </span></span>
<span><span class="co">## [81] doParallel_1.0.17       rprojroot_2.0.3         evaluate_0.22           lattice_0.21-9         </span></span>
<span><span class="co">## [85] Biobase_2.60.0          png_0.1-8               memoise_2.0.1           bslib_0.6.1            </span></span>
<span><span class="co">## [89] Rcpp_1.0.11             xfun_0.40               fs_1.6.3                MatrixGenerics_1.12.3  </span></span>
<span><span class="co">## [93] skmeans_0.2-16          GlobalOptions_0.1.2</span></span></code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  <style>nav[data-toggle='toc'] .nav .nav {display: block;}</style>
</body>
</html>
