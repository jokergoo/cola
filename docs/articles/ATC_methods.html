<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ATC - More Forms • cola</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ATC - More Forms">
<meta property="og:description" content="cola">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cola</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Standard consensus partitioning</li>
    <li>
      <a href="../articles/cola_quick.html">A Quick Start of Using cola Package</a>
    </li>
    <li>
      <a href="../articles/cola_general.html">A Framework for Consensus Partitioning</a>
    </li>
    <li>
      <a href="../articles/functional_enrichment.html">Automatic Functional Enrichment on Signature genes</a>
    </li>
    <li>
      <a href="../articles/predict.html">Predict Classes for New Samples</a>
    </li>
    <li>
      <a href="../articles/work_with_big_datasets.html">Work with Big Datasets</a>
    </li>
    <li>
      <a href="../articles/compare_partitions.html">Compare Partitions</a>
    </li>
    <li>
      <a href="../articles/ATC_methods.html">ATC - More Forms</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Hierarchical partitioning</li>
    <li>
      <a href="../articles/hierarchical.html">Hierarchical consensus partitioning</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Other examples</li>
    <li>
      <a href="../articles/AML.html">Re-analyze an AML proteomics dataset</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">On public datasets</li>
    <li>
      <a href="../articles/examples.html">Applications on public datasets</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Supplementary files</li>
    <li>
      <a href="https://jokergoo.github.io/cola_supplementary/" class="external-link">Supplementary files for cola NAR paper</a>
    </li>
    <li>
      <a href="https://cola-rh.github.io/supplementary/" class="external-link">Supplementary files for cola BIB paper</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/cola/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ATC - More Forms</h1>
                        <h4 data-toc-skip class="author">Zuguang Gu (<a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a>)</h4>
            
            <h4 data-toc-skip class="date">2024-02-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/cola/blob/HEAD/vignettes/ATC_methods.Rmd" class="external-link"><code>vignettes/ATC_methods.Rmd</code></a></small>
      <div class="hidden name"><code>ATC_methods.Rmd</code></div>

    </div>

    
    
<p>For row <span class="math inline">\(i\)</span> in a matrix, denote the variable <span class="math inline">\(X\)</span> as a vector of absolute values of the correlation coefficients to all other rows, evaluated at <span class="math inline">\(x\)</span>, then the ATC score for row <span class="math inline">\(i\)</span> is defined as:</p>
<p><span class="math display">\[ ATC_i = 1 - \int_0^1F_X(x)dx \]</span></p>
<p>where <span class="math inline">\(F_X(x)\)</span> is the cumulative distribution function (CDF) of <span class="math inline">\(X\)</span>.</p>
<p>Figure S1.1 illustrates the empirical CDF (eCDF) curve of <span class="math inline">\(X\)</span> for a certain row <span class="math inline">\(i\)</span>. The ATC score corresponds to the red area above the eCDF curve. It can be imagined that when row <span class="math inline">\(i\)</span> correlates stronger with other rows (both correlation and anti-correlation), the eCDF curve shifts more to the right, thus with higher ATC scores.</p>
<p><img src="ATC_methods_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;"></p>
<p>A simulation test is performed to demonstrate the attributes of the ATC method. A matrix with 160 rows, 100 columns with random values drawn from a multivariate normal distribution is generated. The 160 rows are configured as follows:</p>
<ol style="list-style-type: decimal">
<li>100 rows with mean of 0. The covariance matrix is set to 0 and set 1 to the diagonal;</li>
<li>10 rows with mean of 0. The covariance matrix is set to 0.8 and set 1 to the diagonal. This simulates high correlations but in a small group of rows;</li>
<li>50 rows with mean of 0. The covariance matrix is set to 0.5 and set 1 to the diagonal. This simulates intermediate correlations but in a large group of rows.</li>
</ol>
<p><img src="ATC_methods_files/figure-html/unnamed-chunk-4-1.png" width="1344" style="display: block; margin: auto;"></p>
<p>The first plot in Figure S1.2 is the heatmap for the random matrix, split by the three groups of rows. In the second plot, they are eCDF curves of the correlation of the 160 rows. The third plot is the ATC scores for all 160 rows and the fourth plot is the standard deviation for the 160 rows. Different colors represent different row groups.</p>
<p>All the 160 rows have a similar variance of 1 that they cannot be distinguished by using variance. As a contrast, the rows with non-zero covariance have higher ATC scores (the red and green groups). The ATC scores are even higher when the number of correlated rows increases, although the correlation value itself is relatively small (the green group). This shows ATC method can assign higher scores for rows which correlate to more other rows.</p>
<p>Since the eCDF curve monotonically increases from 0 to 1, for intervals with fixed width, they contribute more to the ATC scores if they are close to 0 (Figure S1.3).</p>
<p><img src="ATC_methods_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
<p>There can be scenarios when a huge number of rows correlate to each other but only with very small correlation values. It results in small right-shift of the eCDF curves for these rows, compared to the scenario where rows are completely uncorrelated. Since the correlation values are close to zero, these small shifts of the eCDF curves results in a relative large increase of ATC scores.</p>
<p>To decrease such effect, the ATC definition can be modified to: For row <span class="math inline">\(i\)</span> in the matrix, denote the variable <span class="math inline">\(X\)</span> as a vector of absolute values of the correlation coefficients to all other rows, evaluated at <span class="math inline">\(x\)</span>, and denote <span class="math inline">\(Y = X^\beta\)</span>, evaluated at <span class="math inline">\(y\)</span>, then the ATC score for row <span class="math inline">\(i\)</span> is defined as:</p>
<p><span class="math display">\[ ATC_i = (1-\alpha) - \int_\alpha^1F_Y(y)dy \]</span></p>
<p>Where <span class="math inline">\(F_Y(y)\)</span> is the CDF of <span class="math inline">\(Y\)</span>. Now <span class="math inline">\(ATC_i\)</span> is the red area above eCDF curve only on the right of <span class="math inline">\(y =\alpha\)</span>. The coefficient <span class="math inline">\(\beta\)</span> is the power added to the absolute correlations that it decreases more for the smaller correlations. By Default <span class="math inline">\(\alpha\)</span> is set to 0 and <span class="math inline">\(\beta\)</span> is set to 1.</p>
<p>We slightly change the previous simulation test that in the first group, we set 500 rows with pairwise correlation to 0.1, which generates 560 rows. Similarly, there are four plots illustrated in Figure S1.4.</p>
<p><img src="ATC_methods_files/figure-html/unnamed-chunk-6-1.png" width="1344" style="display: block; margin: auto;"></p>
<p>In Figure S1.4, we can see group 1 (the black dots), since there are quite a lot of rows, they gain high ATC scores even when they only have tiny correlation values (compare to the rows in group 2, the red dots).</p>
<p>To remove the effect of small correlation, we can set a value larger than 0 to <span class="math inline">\(\alpha\)</span>, e.g. 0.3:</p>
<p><img src="ATC_methods_files/figure-html/unnamed-chunk-7-1.png" width="1344" style="display: block; margin: auto;"></p>
<p>In Figure S1.5, now we see the ATC scores for rows in group 1 decrease.</p>
<p>We can also set <span class="math inline">\(\beta\)</span>, e.g. 3, to decrease the value for rows in group 1, as shown in Figure S1.6.</p>
<p><img src="ATC_methods_files/figure-html/unnamed-chunk-8-1.png" width="1344" style="display: block; margin: auto;"></p>
<div class="section level2">
<h2 id="atc-with-a-categorical-variable">ATC with a categorical variable<a class="anchor" aria-label="anchor" href="#atc-with-a-categorical-variable"></a>
</h2>
<p>In previous section, for row <span class="math inline">\(i\)</span> in a matrix, the variable <span class="math inline">\(\mathbf{X_i}\)</span> is a vector of absolute values of the correlation coefficients to all other rows. When there is also a categorical variable available, <span class="math inline">\(\mathbf{X_i}\)</span> can only contain those rows which are in the same category as row <span class="math inline">\(i\)</span>.</p>
<p><span class="math display">\[ \mathbf{X_i} = \{ abs(\rho_{i, j}) | c_i = c_j, i \ne j\} \]</span></p>
<p>where <span class="math inline">\(\rho_{i,j}\)</span> is the correlation between row <span class="math inline">\(i\)</span> and row <span class="math inline">\(j\)</span>. <span class="math inline">\(c_i\)</span> and <span class="math inline">\(c_j\)</span> are the category labels for row <span class="math inline">\(i\)</span> and row <span class="math inline">\(j\)</span>.</p>
<p>An example of the application is when calculating ATC scores for the methylation dataset, the CpG sites may be in CpG islands or CGI seas. Calculating correlation of methylation between CGIs and CGI seas may not be proper, thus, the CpG annotation (i.e., whether the CpG is in CGI or sea) can be provided as an additional categorical variable so that the correlations are only calculated for the CpG sites with the same annotations.</p>
<p>The categorical variable can be set with the argument <code>group</code>. E.g.:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ATC.html">ATC</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">...</span>, group <span class="op">=</span> <span class="va">cgi_anno</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="atc-knn">ATC-kNN<a class="anchor" aria-label="anchor" href="#atc-knn"></a>
</h2>
<p>ATC method tends to capture global correlation relationships, thus, it is able to capture, e.g. global batch effect. However, sometimes, the real biological meaningful correlation structure only exists in a small portion of rows while not globally. If there exists a globl batch effect, although the individual correlation is small, after accumulated by thousands of features, it leads to a large ATC score, which hides those features which really show meaningful correlations.</p>
<p>Here we provide a method ATC-kNN which only considers <span class="math inline">\(k\)</span> other rows with the most similar correlations to row <span class="math inline">\(i\)</span>. You can simply set the argument <code>k_neighbours</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ATC.html">ATC</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">...</span>, k_neighbours <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The next plot uses the same simulation dataset as previous ones, but only the nearest 10 neighbours (which is the smallest number of rows in the three groups) are considered for correlating. As expected, rows in the second group gain the highest ATC scores.</p>
<p><img src="ATC_methods_files/figure-html/unnamed-chunk-11-1.png" width="1344" style="display: block; margin: auto;"></p>
<p>Note, in many cases, ATC is very similar as ATC-kNN. ATC-kNN shows its advantage only when the meaningful correlation structure exists in a very small portion of rows.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  <style>nav[data-toggle='toc'] .nav .nav {display: block;}</style>
</body>
</html>
